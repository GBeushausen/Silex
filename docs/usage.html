
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Usage &#8212; PrestoPHP 0.0.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Middleware" href="middlewares.html" />
    <link rel="prev" title="Introduction" href="intro.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>If you want to get started fast, use the <a class="reference external" href="https://github.com/PrestoPHPphp/PrestoPHP-Skeleton">PrestoPHP Skeleton</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>composer create-project prestophp/prestophp-skeleton path/to/install
</pre></div>
</div>
<p>If you want more flexibility, use <a class="reference external" href="https://getcomposer.org/">Composer</a> instead:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>composer require PrestoPHP/PrestoPHP:~2.0
</pre></div>
</div>
</div>
<div class="section" id="web-server">
<h2>Web Server<a class="headerlink" href="#web-server" title="Permalink to this headline">¶</a></h2>
<p>All examples in the documentation rely on a well-configured web server; read
the <a class="reference internal" href="web_servers.html"><span class="doc">webserver documentation</span></a> to check yours.</p>
</div>
<div class="section" id="bootstrap">
<h2>Bootstrap<a class="headerlink" href="#bootstrap" title="Permalink to this headline">¶</a></h2>
<p>To bootstrap PrestoPHP, all you need to do is require the <code class="docutils literal notranslate"><span class="pre">vendor/autoload.php</span></code>
file and create an instance of <code class="docutils literal notranslate"><span class="pre">PrestoPHP\Application</span></code>. After your controller
definitions, call the <code class="docutils literal notranslate"><span class="pre">run</span></code> method on your application:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="c1">// web/index.php</span>
<span class="k">require_once</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../vendor/autoload.php&#39;</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PrestoPHP\Application</span><span class="p">();</span>

<span class="c1">// ... definitions</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When developing a website, you might want to turn on the debug mode to
ease debugging:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If your application is hosted behind a reverse proxy at address <code class="docutils literal notranslate"><span class="pre">$ip</span></code>,
and you want PrestoPHP to trust the <code class="docutils literal notranslate"><span class="pre">X-Forwarded-For*</span></code> headers, you will
need to run your application like this:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nx">Request</span><span class="o">::</span><span class="na">setTrustedProxies</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$ip</span><span class="p">));</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="routing">
<h2>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h2>
<p>In PrestoPHP you define a route and the controller that is called when that
route is matched. A route pattern consists of:</p>
<ul class="simple">
<li><p><em>Pattern</em>: The route pattern defines a path that points to a resource. The
pattern can include variable parts and you are able to set RegExp
requirements for them.</p></li>
<li><p><em>Method</em>: One of the following HTTP methods: <code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code>, <code class="docutils literal notranslate"><span class="pre">PUT</span></code>,
<code class="docutils literal notranslate"><span class="pre">DELETE</span></code>, <code class="docutils literal notranslate"><span class="pre">PATCH</span></code>, or <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code>. This describes the interaction with
the resource.</p></li>
</ul>
<p>The controller is defined using a closure like this:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ... do something</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The return value of the closure becomes the content of the page.</p>
<div class="section" id="example-get-route">
<h3>Example GET Route<a class="headerlink" href="#example-get-route" title="Permalink to this headline">¶</a></h3>
<p>Here is an example definition of a <code class="docutils literal notranslate"><span class="pre">GET</span></code> route:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$blogPosts</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;date&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;2011-03-29&#39;</span><span class="p">,</span>
        <span class="s1">&#39;author&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;igorw&#39;</span><span class="p">,</span>
        <span class="s1">&#39;title&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;Using PrestoPHP&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$blogPosts</span> <span class="k">as</span> <span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$output</span> <span class="o">.=</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">];</span>
        <span class="nv">$output</span> <span class="o">.=</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Visiting <code class="docutils literal notranslate"><span class="pre">/blog</span></code> will return a list of blog post titles. The <code class="docutils literal notranslate"><span class="pre">use</span></code>
statement means something different in this context. It tells the closure to
import the <code class="docutils literal notranslate"><span class="pre">$blogPosts</span></code> variable from the outer scope. This allows you to use
it from within the closure.</p>
</div>
<div class="section" id="dynamic-routing">
<h3>Dynamic Routing<a class="headerlink" href="#dynamic-routing" title="Permalink to this headline">¶</a></h3>
<p>Now, you can create another controller for viewing individual blog posts:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">PrestoPHP\Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Post </span><span class="si">$id</span><span class="s2"> does not exist.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$post</span> <span class="o">=</span> <span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">];</span>

    <span class="k">return</span>  <span class="s2">&quot;&lt;h1&gt;</span><span class="si">{</span><span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/h1&gt;&quot;</span><span class="o">.</span>
            <span class="s2">&quot;&lt;p&gt;</span><span class="si">{</span><span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This route definition has a variable <code class="docutils literal notranslate"><span class="pre">{id}</span></code> part which is passed to the
closure.</p>
<p>The current <code class="docutils literal notranslate"><span class="pre">Application</span></code> is automatically injected by PrestoPHP to the Closure
thanks to the type hinting.</p>
<p>When the post does not exist, you are using <code class="docutils literal notranslate"><span class="pre">abort()</span></code> to stop the request
early. It actually throws an exception, which you will see how to handle later
on.</p>
</div>
<div class="section" id="example-post-route">
<h3>Example POST Route<a class="headerlink" href="#example-post-route" title="Permalink to this headline">¶</a></h3>
<p>POST routes signify the creation of a resource. An example for this is a
feedback form. You will use the <code class="docutils literal notranslate"><span class="pre">mail</span></code> function to send an e-mail:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/feedback&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>
    <span class="nb">mail</span><span class="p">(</span><span class="s1">&#39;feedback@yoursite.com&#39;</span><span class="p">,</span> <span class="s1">&#39;[YourSite] Feedback&#39;</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Thank you for your feedback!&#39;</span><span class="p">,</span> <span class="mi">201</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>It is pretty straightforward.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a <a class="reference internal" href="providers/swiftmailer.html"><span class="doc">SwiftmailerServiceProvider</span></a>
included that you can use instead of <code class="docutils literal notranslate"><span class="pre">mail()</span></code>.</p>
</div>
<p>The current <code class="docutils literal notranslate"><span class="pre">request</span></code> is automatically injected by PrestoPHP to the Closure
thanks to the type hinting. It is an instance of
<a class="reference external" href="https://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html">Request</a>, so you can fetch variables using the request <code class="docutils literal notranslate"><span class="pre">get</span></code> method.</p>
<p>Instead of returning a string you are returning an instance of <a class="reference external" href="https://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html">Response</a>.
This allows setting an HTTP status code, in this case it is set to
<code class="docutils literal notranslate"><span class="pre">201</span> <span class="pre">Created</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>PrestoPHP always uses a <code class="docutils literal notranslate"><span class="pre">Response</span></code> internally, it converts strings to
responses with status code <code class="docutils literal notranslate"><span class="pre">200</span></code>.</p>
</div>
</div>
<div class="section" id="other-methods">
<h3>Other methods<a class="headerlink" href="#other-methods" title="Permalink to this headline">¶</a></h3>
<p>You can create controllers for most HTTP methods. Just call one of these
methods on your application: <code class="docutils literal notranslate"><span class="pre">get</span></code>, <code class="docutils literal notranslate"><span class="pre">post</span></code>, <code class="docutils literal notranslate"><span class="pre">put</span></code>, <code class="docutils literal notranslate"><span class="pre">delete</span></code>, <code class="docutils literal notranslate"><span class="pre">patch</span></code>, <code class="docutils literal notranslate"><span class="pre">options</span></code>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">patch</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Forms in most web browsers do not directly support the use of other HTTP
methods. To use methods other than GET and POST you can utilize a special
form field with a name of <code class="docutils literal notranslate"><span class="pre">_method</span></code>. The form’s <code class="docutils literal notranslate"><span class="pre">method</span></code> attribute must
be set to POST when using this field:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/my/target/route/&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;_method&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;_method&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;PUT&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>You need to explicitly enable this method override:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nx">Request</span><span class="o">::</span><span class="na">enableHttpMethodParameterOverride</span><span class="p">();</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</div>
</div>
<p>You can also call <code class="docutils literal notranslate"><span class="pre">match</span></code>, which will match all methods. This can be
restricted via the <code class="docutils literal notranslate"><span class="pre">method</span></code> method:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;PATCH&#39;</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;PUT|POST&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The order in which the routes are defined is significant. The first
matching route will be used, so place more generic routes at the bottom.</p>
</div>
</div>
<div class="section" id="route-variables">
<h3>Route Variables<a class="headerlink" href="#route-variables" title="Permalink to this headline">¶</a></h3>
<p>As it has been shown before you can define variable parts in a route like
this:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>It is also possible to have more than one variable part, just make sure the
closure arguments match the names of the variable parts:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$postId</span><span class="p">,</span> <span class="nv">$commentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>While it’s not recommended, you could also do this (note the switched
arguments):</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$commentId</span><span class="p">,</span> <span class="nv">$postId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can also ask for the current Request and Application objects:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note for the Application and Request objects, PrestoPHP does the injection
based on the type hinting and not on the variable name:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Application</span> <span class="nv">$foo</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$bar</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="route-variable-converters">
<h3>Route Variable Converters<a class="headerlink" href="#route-variable-converters" title="Permalink to this headline">¶</a></h3>
<p>Before injecting the route variables into the controller, you can apply some
converters:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$id</span><span class="p">;</span> <span class="p">});</span>
</pre></div>
</div>
<p>This is useful when you want to convert route variables to objects as it
allows to reuse the conversion code across different controllers:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$userProvider</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$userProvider</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}/edit&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$userProvider</span><span class="p">);</span>
</pre></div>
</div>
<p>The converter callback also receives the <code class="docutils literal notranslate"><span class="pre">Request</span></code> as its second argument:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$callback</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$post</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;slug&#39;</span><span class="p">));</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}/{slug}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="nv">$callback</span><span class="p">);</span>
</pre></div>
</div>
<p>A converter can also be defined as a service. For example, here is a user
converter based on Doctrine ObjectManager:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\ObjectManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Exception\NotFoundHttpException</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserConverter</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$om</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">ObjectManager</span> <span class="nv">$om</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">om</span> <span class="o">=</span> <span class="nv">$om</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">convert</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">===</span> <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">om</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$id</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundHttpException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;User %d does not exist&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The service will now be registered in the application, and the
<code class="docutils literal notranslate"><span class="pre">convert()</span></code> method will be used as converter (using the syntax
<code class="docutils literal notranslate"><span class="pre">service_name:method_name</span></code>):</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;converter.user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">UserConverter</span><span class="p">();</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{user}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;converter.user:convert&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>In some cases you may want to only match certain expressions. You can define
requirements using regular expressions by calling <code class="docutils literal notranslate"><span class="pre">assert</span></code> on the
<code class="docutils literal notranslate"><span class="pre">Controller</span></code> object, which is returned by the routing methods.</p>
<p>The following will make sure the <code class="docutils literal notranslate"><span class="pre">id</span></code> argument is a positive integer, since
<code class="docutils literal notranslate"><span class="pre">\d+</span></code> matches any amount of digits:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>You can also chain these calls:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{postId}/{commentId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$postId</span><span class="p">,</span> <span class="nv">$commentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;postId&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">)</span>
<span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;commentId&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="conditions">
<h3>Conditions<a class="headerlink" href="#conditions" title="Permalink to this headline">¶</a></h3>
<p>Besides restricting route matching based on the HTTP method or parameter
requirements, you can set conditions on any part of the request by calling
<code class="docutils literal notranslate"><span class="pre">when</span></code> on the <code class="docutils literal notranslate"><span class="pre">Controller</span></code> object, which is returned by the routing
methods:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">when</span><span class="p">(</span><span class="s2">&quot;request.headers.get(&#39;User-Agent&#39;) matches &#39;/firefox/i&#39;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">when</span></code> argument is a Symfony <a class="reference external" href="https://symfony.com/doc/current/book/routing.html#completely-customized-route-matching-with-conditions">Expression</a> , which means that you need to
add <code class="docutils literal notranslate"><span class="pre">symfony/expression-language</span></code> as a dependency of your project.</p>
</div>
<div class="section" id="default-values">
<h3>Default Values<a class="headerlink" href="#default-values" title="Permalink to this headline">¶</a></h3>
<p>You can define a default value for any route variable by calling <code class="docutils literal notranslate"><span class="pre">value</span></code> on
the <code class="docutils literal notranslate"><span class="pre">Controller</span></code> object:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/{pageName}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$pageName</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">value</span><span class="p">(</span><span class="s1">&#39;pageName&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>This will allow matching <code class="docutils literal notranslate"><span class="pre">/</span></code>, in which case the <code class="docutils literal notranslate"><span class="pre">pageName</span></code> variable will
have the value <code class="docutils literal notranslate"><span class="pre">index</span></code>.</p>
</div>
<div class="section" id="named-routes">
<h3>Named Routes<a class="headerlink" href="#named-routes" title="Permalink to this headline">¶</a></h3>
<p>Some providers can make use of named routes. By default PrestoPHP will generate an
internal route name for you but you can give an explicit route name by calling
<code class="docutils literal notranslate"><span class="pre">bind</span></code>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;homepage&#39;</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;blog_post&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="controllers-as-classes">
<h3>Controllers as Classes<a class="headerlink" href="#controllers-as-classes" title="Permalink to this headline">¶</a></h3>
<p>Instead of anonymous functions, you can also define your controllers as
methods. By using the <code class="docutils literal notranslate"><span class="pre">ControllerClass::methodName</span></code> syntax, you can tell
PrestoPHP to lazily create the controller object for you:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;Acme\\Foo::bar&#39;</span><span class="p">);</span>

<span class="k">use</span> <span class="nx">PrestoPHP\Application</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nx">Acme</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Foo</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Application</span> <span class="nv">$app</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will load the <code class="docutils literal notranslate"><span class="pre">Acme\Foo</span></code> class on demand, create an instance and call
the <code class="docutils literal notranslate"><span class="pre">bar</span></code> method to get the response. You can use <code class="docutils literal notranslate"><span class="pre">Request</span></code> and
<code class="docutils literal notranslate"><span class="pre">PrestoPHP\Application</span></code> type hints to get <code class="docutils literal notranslate"><span class="pre">$request</span></code> and <code class="docutils literal notranslate"><span class="pre">$app</span></code> injected.</p>
<p>It is also possible to <a class="reference internal" href="providers/service_controller.html"><span class="doc">define your controllers as services</span></a>.</p>
</div>
</div>
<div class="section" id="global-configuration">
<h2>Global Configuration<a class="headerlink" href="#global-configuration" title="Permalink to this headline">¶</a></h2>
<p>If a controller setting must be applied to <strong>all</strong> controllers (a converter, a
middleware, a requirement, or a default value), configure it on
<code class="docutils literal notranslate"><span class="pre">$app['controllers']</span></code>, which holds all application controllers:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;controllers&#39;</span><span class="p">]</span>
    <span class="o">-&gt;</span><span class="na">value</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">assert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;\d+&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">requireHttps</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">before</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">when</span><span class="p">(</span><span class="s1">&#39;request.isSecure() == true&#39;</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
<p>These settings are applied to already registered controllers and they become
the defaults for new controllers.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The global configuration does not apply to controller providers you might
mount as they have their own global configuration (read the
<a class="reference internal" href="organizing_controllers.html"><span class="doc">dedicated chapter</span></a> for more information).</p>
</div>
</div>
<div class="section" id="error-handlers">
<h2>Error Handlers<a class="headerlink" href="#error-handlers" title="Permalink to this headline">¶</a></h2>
<p>When an exception is thrown, error handlers allow you to display a custom
error page to the user. They can also be used to do additional things, such as
logging.</p>
<p>To register an error handler, pass a closure to the <code class="docutils literal notranslate"><span class="pre">error</span></code> method which
takes an <code class="docutils literal notranslate"><span class="pre">Exception</span></code> argument and returns a response:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;We are sorry, but something went terribly wrong.&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can also check for specific errors by using the <code class="docutils literal notranslate"><span class="pre">$code</span></code> argument, and
handle them differently:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">404</span><span class="o">:</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;The requested page could not be found.&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;We are sorry, but something went terribly wrong.&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can restrict an error handler to only handle some Exception classes by
setting a more specific type hint for the Closure argument:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\LogicException</span> <span class="nv">$e</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// this handler will only handle \LogicException exceptions</span>
    <span class="c1">// and exceptions that extend \LogicException</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As PrestoPHP ensures that the Response status code is set to the most
appropriate one depending on the exception, setting the status on the
response alone won’t work.</p>
<p>If you want to overwrite the status code, which you should not without a
good reason, set the <code class="docutils literal notranslate"><span class="pre">X-Status-Code</span></code> header (on Symfony until version
3.2):</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="mi">404</span> <span class="cm">/* ignored */</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;X-Status-Code&#39;</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">));</span>
</pre></div>
</div>
<p>As of Symfony 5.0, call
<code class="docutils literal notranslate"><span class="pre">ExceptionEvent::allowCustomResponseCode()</span></code> first and then
then set the status code on the response as normal. The kernel will now use
your status code when sending the response to the client. The
<code class="docutils literal notranslate"><span class="pre">ExceptionEvent</span></code> is passed to the error callback as a 4th
parameter:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Event\ExceptionEvent</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$code</span><span class="p">,</span> <span class="nx">ExceptionEvent</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">allowCustomResponseCode</span><span class="p">();</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;No Content&#39;</span><span class="p">,</span> <span class="mi">204</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>If you want to use a separate error handler for logging, make sure you register
it with a higher priority than response error handlers, because once a response
is returned, the following handlers are ignored.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>PrestoPHP ships with a provider for <a class="reference external" href="https://github.com/Seldaek/monolog">Monolog</a> which handles logging of errors.
Check out the <em>Providers</em> <a class="reference internal" href="providers/monolog.html"><span class="doc">chapter</span></a> for details.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>PrestoPHP comes with a default error handler that displays a detailed error
message with the stack trace when <strong>debug</strong> is true, and a simple error
message otherwise. Error handlers registered via the <code class="docutils literal notranslate"><span class="pre">error()</span></code> method
always take precedence but you can keep the nice error messages when debug
is turned on like this:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ... logic to handle the error and return a Response</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<p>The error handlers are also called when you use <code class="docutils literal notranslate"><span class="pre">abort</span></code> to abort a request
early:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/blog/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">PrestoPHP\Application</span> <span class="nv">$app</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$blogPosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$blogPosts</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Post </span><span class="si">$id</span><span class="s2"> does not exist.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can convert errors to <code class="docutils literal notranslate"><span class="pre">Exceptions</span></code>, check out the cookbook <a class="reference internal" href="cookbook/error_handler.html"><span class="doc">chapter</span></a> for details.</p>
</div>
<div class="section" id="view-handlers">
<h2>View Handlers<a class="headerlink" href="#view-handlers" title="Permalink to this headline">¶</a></h2>
<p>View Handlers allow you to intercept a controller result that is not a
<code class="docutils literal notranslate"><span class="pre">Response</span></code> and transform it before it gets returned to the kernel.</p>
<p>To register a view handler, pass a callable (or string that can be resolved to a
callable) to the <code class="docutils literal notranslate"><span class="pre">view()</span></code> method. The callable should accept some sort of result
from the controller:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="k">array</span> <span class="nv">$controllerResult</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$controllerResult</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>View Handlers also receive the <code class="docutils literal notranslate"><span class="pre">Request</span></code> as their second argument,
making them a good candidate for basic content negotiation:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="k">array</span> <span class="nv">$controllerResult</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$acceptHeader</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Accept&#39;</span><span class="p">);</span>
    <span class="nv">$bestFormat</span> <span class="o">=</span> <span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;negotiator&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getBestFormat</span><span class="p">(</span><span class="nv">$acceptHeader</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;xml&#39;</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;json&#39;</span> <span class="o">===</span> <span class="nv">$bestFormat</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">JsonResponse</span><span class="p">(</span><span class="nv">$controllerResult</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;xml&#39;</span> <span class="o">===</span> <span class="nv">$bestFormat</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;serializer.xml&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">renderResponse</span><span class="p">(</span><span class="nv">$controllerResult</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$controllerResult</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>View Handlers will be examined in the order they are added to the application
and PrestoPHP will use type hints to determine if a view handler should be used for
the current result, continuously using the return value of the last view handler
as the input for the next.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must ensure that PrestoPHP receives a <code class="docutils literal notranslate"><span class="pre">Response</span></code> or a string as the result of
the last view handler (or controller) to be run.</p>
</div>
</div>
<div class="section" id="redirects">
<h2>Redirects<a class="headerlink" href="#redirects" title="Permalink to this headline">¶</a></h2>
<p>You can redirect to another page by returning a <code class="docutils literal notranslate"><span class="pre">RedirectResponse</span></code> response,
which you can create by calling the <code class="docutils literal notranslate"><span class="pre">redirect</span></code> method:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This will redirect from <code class="docutils literal notranslate"><span class="pre">/</span></code> to <code class="docutils literal notranslate"><span class="pre">/hello</span></code>.</p>
</div>
<div class="section" id="forwards">
<h2>Forwards<a class="headerlink" href="#forwards" title="Permalink to this headline">¶</a></h2>
<p>When you want to delegate the rendering to another controller, without a
round-trip to the browser (as for a redirect), use an internal sub-request:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\HttpKernelInterface</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// forward to /hello</span>
    <span class="nv">$subRequest</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$subRequest</span><span class="p">,</span> <span class="nx">HttpKernelInterface</span><span class="o">::</span><span class="na">SUB_REQUEST</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can also generate the URI via the built-in URL generator:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;url_generator&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">),</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>There’s some more things that you need to keep in mind though. In most cases you
will want to forward some parts of the current master request to the sub-request.
That includes: Cookies, server information, session.
Read more on <a class="reference internal" href="cookbook/sub_requests.html"><span class="doc">how to make sub-requests</span></a>.</p>
</div>
<div class="section" id="json">
<h2>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h2>
<p>If you want to return JSON data, you can use the <code class="docutils literal notranslate"><span class="pre">json</span></code> helper method.
Simply pass it your data, status code and headers, and it will create a JSON
response for you:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/users/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="nx">getUser</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The user was not found.&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$error</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="streaming">
<h2>Streaming<a class="headerlink" href="#streaming" title="Permalink to this headline">¶</a></h2>
<p>It’s possible to stream a response, which is important in cases when you don’t
want to buffer the data being sent:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/images/{file}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/images/&#39;</span><span class="o">.</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s1">&#39;The image was not found.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$stream</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">readfile</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">stream</span><span class="p">(</span><span class="nv">$stream</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;image/png&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
<p>If you need to send chunks, make sure you call <code class="docutils literal notranslate"><span class="pre">ob_flush</span></code> and <code class="docutils literal notranslate"><span class="pre">flush</span></code>
after every chunk:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$stream</span> <span class="o">=</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nv">$fh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;http://www.example.com/&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fh</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$fh</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span>
        <span class="nb">ob_flush</span><span class="p">();</span>
        <span class="nb">flush</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fh</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="sending-a-file">
<h2>Sending a file<a class="headerlink" href="#sending-a-file" title="Permalink to this headline">¶</a></h2>
<p>If you want to return a file, you can use the <code class="docutils literal notranslate"><span class="pre">sendFile</span></code> helper method.
It eases returning files that would otherwise not be publicly available. Simply
pass it your file path, status code, headers and the content disposition and it
will create a <code class="docutils literal notranslate"><span class="pre">BinaryFileResponse</span></code> response for you:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/files/{path}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$path</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="s1">&#39;/base/path/&#39;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">sendFile</span><span class="p">(</span><span class="s1">&#39;/base/path/&#39;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>To further customize the response before returning it, check the API doc for
<a class="reference external" href="https://api.symfony.com/master/Symfony/Component/HttpFoundation/BinaryFileResponse.html">SymfonyComponentHttpFoundationBinaryFileResponse</a>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="nv">$app</span>
    <span class="o">-&gt;</span><span class="na">sendFile</span><span class="p">(</span><span class="s1">&#39;/base/path/&#39;</span> <span class="o">.</span> <span class="nv">$path</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setContentDisposition</span><span class="p">(</span><span class="nx">ResponseHeaderBag</span><span class="o">::</span><span class="na">DISPOSITION_ATTACHMENT</span><span class="p">,</span> <span class="s1">&#39;pic.jpg&#39;</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="traits">
<h2>Traits<a class="headerlink" href="#traits" title="Permalink to this headline">¶</a></h2>
<p>PrestoPHP comes with PHP traits that define shortcut methods.</p>
<p>Almost all built-in service providers have some corresponding PHP traits. To
use them, define your own Application class and include the traits you want:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PrestoPHP\Application</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyApplication</span> <span class="k">extends</span> <span class="nx">Application</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Application\TwigTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\SecurityTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\FormTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\UrlGeneratorTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\SwiftmailerTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\MonologTrait</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">Application\TranslationTrait</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also define your own Route class and use some traits:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PrestoPHP\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyRoute</span> <span class="k">extends</span> <span class="nx">Route</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Route\SecurityTrait</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To use your newly defined route, override the <code class="docutils literal notranslate"><span class="pre">$app['route_class']</span></code>
setting:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$app</span><span class="p">[</span><span class="s1">&#39;route_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MyRoute&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Read each provider chapter to learn more about the added methods.</p>
</div>
<div class="section" id="security">
<h2>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<p>Make sure to protect your application against attacks.</p>
<div class="section" id="escaping">
<h3>Escaping<a class="headerlink" href="#escaping" title="Permalink to this headline">¶</a></h3>
<p>When outputting any user input, make sure to escape it correctly to prevent
Cross-Site-Scripting attacks.</p>
<ul>
<li><p><strong>Escaping HTML</strong>: PHP provides the <code class="docutils literal notranslate"><span class="pre">htmlspecialchars</span></code> function for this.
PrestoPHP provides a shortcut <code class="docutils literal notranslate"><span class="pre">escape</span></code> method:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/name&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">PrestoPHP\Application</span> <span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="s2">&quot;You provided the name </span><span class="si">{</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">escape</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>If you use the Twig template engine, you should use its escaping or even
auto-escaping mechanisms. Check out the <em>Providers</em> <a class="reference internal" href="providers/twig.html"><span class="doc">chapter</span></a> for details.</p>
</li>
<li><p><strong>Escaping JSON</strong>: If you want to provide data in JSON format you should
use the PrestoPHP <code class="docutils literal notranslate"><span class="pre">json</span></code> function:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/name.json&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">PrestoPHP\Application</span> <span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PrestoPHP</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="middlewares.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="organizing_controllers.html">Organizing Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="providers.html">Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookbook/index.html">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html#writing-documentation">Writing Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="providers/index.html">Built-in Service Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_servers.html">Webserver Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="intro.html" title="previous chapter">Introduction</a></li>
      <li>Next: <a href="middlewares.html" title="next chapter">Middleware</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2010 Fabien Potencier.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/usage.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>